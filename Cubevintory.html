<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
  <script src="https://unpkg.com/konva@9/konva.min.js"></script>
  <script src="js/GridLogic.js"></script>
  <script src="js/ItemSpawner.js"></script>
  <script src="js/AutofillCombobox.js"></script>
  <script src="js/Equipment.js"></script>

</head>

<body>
  <div class="ui-widget">
    <label>Spawn Item:</label>
    <select id="EquipmentComboBox">

    </select>
  </div>

  <div id="container"></div>




  <div id="menu">
    <div>
      <button id="rotate-button">Rotate</button>
      <button id="flip-button">Flip</button>
      <button id="delete-button">Delete</button>
    </div>
  </div>
</body>




<script>

  //TODO

  //have some other graphic to tell when something is colliding? - May wanna use red colour. 
  //  Yeah use an image or something.
  //    image turned out to be dead end
  //    For now, we store the intended colour to be reverted to. Want a different solution.

  
  //change cube physical size. too large?
  //  currently set to 80

  //spawn items from PHB
  //  needs searchable combobox - JQuery has one
  //  WIP:
  //    Want combobox to clear once something is made
  //    Make combobox scrollable (https://jqueryui.com/autocomplete/#maxheight)
  //    needs a switch statement on how to create item - generic or a specialized one
  //    What to do about colour
  //      Keep entire json object in value so I can use other attributes to determine colour?
  
  //Save feature

  //FUTURE

  //Custom Items
  //Bag of Holding and other tools to aid in Encumberance
  //  Like a mule or horse.
  

  //BUGS

  //Collision is removed when interacting with a different shape.
  //  eg, two objects collide and turn red, move third not touching either and the og two are now fine.
  //  change who/where gets their 'isColliding' set false

  //SpawnGenericItem will create something larger that 5 across. need to cap that.

  var GUIDELINE_OFFSET = 10;
  var GRID_PADDING = 80;
  var GRID_SIZE = 80;

  var strength = 10;

  var width = (15 * GRID_SIZE)+ GRID_PADDING + 500; //500 is for extra room for spawning itemas and controls
  var height = (20 * GRID_SIZE) + GRID_PADDING; // 20 is max strength

  // first we need to create a stage
  var stage = new Konva.Stage({
    container: 'container',
    width: width,
    height: height,
  });

  stage.add(createGridLayer(strength));
  stage.draw();

  // create layer for shapes
  var layer = new Konva.Layer();
  // add the layer to the stage
  stage.add(layer);

  InitializeMenu();
  InitializeCollisionSnapping()
  
  var obj = JSON.parse(EquipmentJSON);

  //loop through and create html Options for all
  for (let i = 0; i < obj.length; i++) {
    $('#EquipmentComboBox').append($('<option>', {
      value: obj[i].weight,
      text: obj[i].name
    }));
  }

  initializeItemCombobox()

function spawnItem(name, weight){
  layer.add(spawnGenericItem(name, weight))
}



</script>

<style>
  /* body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #f0f0f0;
    } */

  #menu {
    display: none;
    position: absolute;
    width: 60px;
    background-color: white;
    box-shadow: 0 0 5px grey;
    border-radius: 3px;
  }

  #menu button {
    width: 100%;
    background-color: white;
    border: none;
    margin: 0;
    padding: 10px;
  }

  #menu button:hover {
    background-color: lightgray;
  }
</style>